name: Pull feeds (daily)

on:
  schedule:
    # Every 3 hours (UTC). Change to "0 8 * * *" for once per day at 08:00 UTC.
    - cron: "0 */3 * * *"
  workflow_dispatch: {}   # allows the green "Run workflow" button

permissions:
  contents: write   # needed so the job can commit feeds.json back to the repo

jobs:
  pull:
    runs-on: ubuntu-latest

    steps:
      - name: Check out
        uses: actions/checkout@v4

      - name: Use Node.js 22
        uses: actions/setup-node@v4
        with:
          node-version: 22
          cache: npm

      - name: Install deps
        run: npm ci

      - name: Pull feeds
        run: npm run pull:feeds

      - name: Commit updated JSON
        uses: EndBug/add-and-commit@v9
        with:
          add: "public/feeds.json public/ingestion.json"
          message: "chore: pull feeds (bot)"
          default_author: github_actions
